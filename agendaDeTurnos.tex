\documentclass[%
  fleqn,colorlinks,linkcolor=blue,citecolor=blue,urlcolor=blue]{eptcs}
\usepackage[latin1]{inputenc}
\usepackage[spanish]{babel}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{z-eves}
\usepackage{framed}
\usepackage[latin1]{inputenc}
\usepackage[spanish]{babel}
\usepackage{xspace}

\newcommand{\desig}[2]{\item #1 $\approx #2$}
\newenvironment{designations}
  {\begin{leftbar}
    \begin{list}{}{\setlength{\labelsep}{0cm}
                   \setlength{\labelwidth}{0cm}
                   \setlength{\listparindent}{0cm}
                   \setlength{\rightmargin}{\leftmargin}}}
  {\end{list}\end{leftbar}}

  \DeclareMathOperator{\Ima}{Im}

  \newcommand{\setlog}{$\{log\}$\xspace}

  \def\titlerunning{\setlog}
  \def\authorrunning{F. Sansone}

  \title{Trabajo Pr\'actico para Ingenier\'i{}a de Software}
  \author{Franco Sansone}

  \date{2019}

  \begin{document}
  \thispagestyle{empty}
  \maketitle

  \section{Requerimientos}
  El usuario puede asociar un cliente (paciente si estuviese relacionado a la medicina) por nombre y DNI a un d\'i{}a y horario. Puede dar de baja un turno.

  Se puede filtrar por fecha, nombre y DNI.

  Podr\'i{}a ser usado por cualquiera que desarrolle sus actividades mediante turnos (m\'edicos, docentes que den clases particulares, psic\'ologos, etc).

  \section{Especificaci\'on}
  Designaciones.

  \begin{designations}
  \desig{$d$ es un DNI}{d \in DNI}
  \desig{$n$ es un nombre}{n \in NAME}
  \desig{$f$ es una fecha y hora}{f \in DATETIME}
  \desig{El nombre de la persona con DNI $k$}{clientes~k}
  \desig{La fecha y hora del turno de la persona con DNI $k$}{turnos~k}
  \end{designations}

  Entonces introducimos los siguientes tipos b\'asicos.

  \begin{zed}
  [DNI,NOMBRE,DATETIME]
  \end{zed}

  Ahora podemos definir el espacio de estados de la especificaci\'on de la siguiente forma.

  \begin{schema}{AgendaDeTurnos}
  clientes: DNI \pfun NOMBRE \\
  turnos: DATETIME \pfun DNI
  \end{schema}

  El estado inicial de la agenda de turnos es el siguiente.

  \begin{schema}{AgendaDeTurnosInit}
  AgendaDeTurnos
  \where
  clientes = \emptyset \\
  turnos = \emptyset
  \end{schema}

  Primero modelo el esquema que describe los predicados que deber\'i{}an ser invariantes de estado.

  \begin{schema}{AgendaDeTurnosInv}
  AgendaDeTurnos
  \where
  \dom clientes = \Ima turnos
  \end{schema}

  Avanzo con la primera operaci\'on: asignar un turno.

  \begin{schema}{AsignarTurnoPrimeraVez}
  \Delta AgendaDeTurnos \\
  nombre?:NAME \\
  dni?:DNI \\
  fecha?:DATETIME \\
  ahora?:DATETIME \\
  \where
  dni? \notin \dom clientes \\
  fecha? \notin \dom turnos \\
  fecha?>ahora? \\
  clientes' = clientes \cup \{dni? \mapsto name?\} \\
  turnos' = turnos \cup \{fecha? \mapsto dni?\} \\
  \end{schema}

  El argumento de entrada ahora? no necesariamente tiene que ser una entrada ingresada por el usuario.
  El pasaje de este argumento a la subrutina deber\'i{}a ser transparente para el usuario.

  \begin{schema}{AsignarTurnoCliente}
  \Delta AgendaDeTurnos \\
  dni?:DNI \\
  fecha?:DATETIME \\
  ahora?:DATETIME
  \where
  dni? \in \dom clientes \\
  fecha? \notin \dom turnos \\
  fecha? > ahora? \\
  turnos' = turnos \cup \{fecha? \mapsto dni?\} \\
  clientes' = clientes \\
  \end{schema}

  \begin{schema}{ErrorFechaPasada}
  \Xi AgendaDeTurnos \\
  fecha?:DATETIME \\
  ahora?:DATETIME \\
  \where
  fecha? <= ahora? \\
  \end{schema}

  \begin{schema}{TurnoYaAsignado}
  \Xi AgendaDeTurnos \\
  fecha?:DATETIME \\
  \where
  fecha? \in turnos
  \end{schema}

  \begin{zed}
  AsignarTurnoOk  == AsignarTurnoPrimeraVez \lor AsignarTurnoCliente \\
  AsignarTurnoError == ErrorFechaPasada \lor TurnoYaAsignado \\
  AsignarTurno == AsignarTurnoOk \lor AsignarTurnoError
  \end{zed}

  Las siguientes operaciones corresponden a la b\'usqueda de turnos por nombre, DNI y fecha.

  \begin{schema}{BusquedaPorDNIOk}
  \Xi AgendaDeTurnos \\
  dni?:DNI \\
  resp!:DATETIME \\
  \where
  dni? \in \dom clientes \\
  resp! = \dom(turnos \dres \{dni?\})
  \end{schema}

  \begin{schema}{ClienteNoExisteDNI}
  \Xi AgendaDeTurnos \\
  dni?:DNI \\
  \where
  dni? \notin \dom clientes
  \end{schema}

  \begin{zed}
  BusquedaPorDNI == BusquedaPorDNIOk \lor ClienteNoExisteDNI
  \end{zed}

  \begin{schema}{BusquedaPorNombreOk}
  \Xi AgendaDeTurnos \\
  nombre?:NOMBRE \\
  resp! = DATETIME \pfun DNI \\
  \where
  nombre? \in \Ima clientes \\
  resp! = turnos \dres \dom (clientes \dres \{nombre?\})
  \end{schema}

  \begin{schema}{ClienteNoExisteNombre}
  \Xi AgendaDeTurnos \\
  nombre?:NOMBRE \\
  \where
  nombre \notin \Ima clientes
  \end{schema}

  \begin{zed}
  BusquedaPorNombre == BusquedaPorNombreOk \lor ClienteNoExisteNombre
  \end{zed}

  \begin{schema}{BusquedaPorFecha}
  \Xi AgendaDeTurnos \\
  dia?:\power DATETIME \\
  resp!:DATETIME \pfun DNI
  \where
  resp! = turnos \rres dia?
  \end{schema}



\end{document}
